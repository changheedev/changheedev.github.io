<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.1"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="React 프로젝트 배포 삽질기" /><meta name="author" content="Changhee" /><meta property="og:locale" content="en_US" /><meta name="description" content="부스트캠프 멤버십 과정의 3주 팀 프로젝트를 시작하면서 가장 먼저 해야겠다고 생각한 작업은 배포 자동화 작업이었다. 그 이유는 팀 회의에서 배포 전략을 특정 일을 기준으로 작업을 모은 후 배포를 시키는 것이 아닌 기능이 완성될 때마다 꾸준히 지속적으로 배포를 시키는 것으로 정했고, 그러기 위해서는 배포를 쉽고 간단하게 진행할 수 있어야 하기 때문이다. (배포 과정이 복잡하고 어려우면 배포 하는 것을 꺼리게 된다..)" /><meta property="og:description" content="부스트캠프 멤버십 과정의 3주 팀 프로젝트를 시작하면서 가장 먼저 해야겠다고 생각한 작업은 배포 자동화 작업이었다. 그 이유는 팀 회의에서 배포 전략을 특정 일을 기준으로 작업을 모은 후 배포를 시키는 것이 아닌 기능이 완성될 때마다 꾸준히 지속적으로 배포를 시키는 것으로 정했고, 그러기 위해서는 배포를 쉽고 간단하게 진행할 수 있어야 하기 때문이다. (배포 과정이 복잡하고 어려우면 배포 하는 것을 꺼리게 된다..)" /><link rel="canonical" href="https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/" /><meta property="og:url" content="https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/" /><meta property="og:site_name" content="Changhee" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-09T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="React 프로젝트 배포 삽질기" /><meta name="google-site-verification" content="pI8ii9r0vewLzzWaXCy_gcfqRLia4i9u82XZdv5m-Lo" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Changhee"},"description":"부스트캠프 멤버십 과정의 3주 팀 프로젝트를 시작하면서 가장 먼저 해야겠다고 생각한 작업은 배포 자동화 작업이었다. 그 이유는 팀 회의에서 배포 전략을 특정 일을 기준으로 작업을 모은 후 배포를 시키는 것이 아닌 기능이 완성될 때마다 꾸준히 지속적으로 배포를 시키는 것으로 정했고, 그러기 위해서는 배포를 쉽고 간단하게 진행할 수 있어야 하기 때문이다. (배포 과정이 복잡하고 어려우면 배포 하는 것을 꺼리게 된다..)","url":"https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/","@type":"BlogPosting","headline":"React 프로젝트 배포 삽질기","dateModified":"2020-11-09T00:00:00+09:00","datePublished":"2020-11-09T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/"},"@context":"https://schema.org"}</script><title>React 프로젝트 배포 삽질기 | Changhee</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-SV90EJRY87"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SV90EJRY87'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars1.githubusercontent.com/u/17294694?s=460&u=ff808a49e15ba27ba7c8e0a960aa44a78c9b672b&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Changhee</a></div><div class="site-subtitle font-italic">학습과 경험을 기록하는 개인 개발 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/changheedev" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['changhee.dev','gmail.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>React 프로젝트 배포 삽질기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>React 프로젝트 배포 삽질기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 9, 2020, 12:00 AM +0900" > Nov 9, 2020 <i class="unloaded">2020-11-09T00:00:00+09:00</i> </span> by <span class="author"> Changhee </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1765 words">9 min</span></div></div><div class="post-content"><p>부스트캠프 멤버십 과정의 3주 팀 프로젝트를 시작하면서 가장 먼저 해야겠다고 생각한 작업은 배포 자동화 작업이었다. 그 이유는 팀 회의에서 배포 전략을 특정 일을 기준으로 작업을 모은 후 배포를 시키는 것이 아닌 기능이 완성될 때마다 꾸준히 지속적으로 배포를 시키는 것으로 정했고, 그러기 위해서는 배포를 쉽고 간단하게 진행할 수 있어야 하기 때문이다. (배포 과정이 복잡하고 어려우면 배포 하는 것을 꺼리게 된다..)</p><p>그래서 첫 1주는 틈틈이 GitHub Action과 Docker를 이용하여 배포 자동화 환경을 구축하는 작업을 진행했었는데, 그 과정에서 겪었던 이슈를 한번 정리해보려고 한다.</p><p>먼저 프로젝트의 기술 스택은 아래와 같이 구성되어 있다.</p><p><strong>FrontEnd</strong></p><ul><li>React<li>Webpack + Babel</ul><p><strong>BackEnd</strong></p><ul><li>Node.js<li>Express</ul><p><strong>DB</strong></p><ul><li>MySQL</ul><p><strong>CI/CD</strong></p><ul><li>GitHub Action<li>Docker</ul><p><strong>CI/CD 툴로 GitHub Action과 Docker를 선택한 이유</strong></p><p><code class="language-plaintext highlighter-rouge">GitHub Action</code>은 자체적으로 workflow 실행을 위한 서버 환경을 제공해주고 Travis CI 와 같은 별도의 툴을 사용하지 않으면서 관리 포인트가 GitHub 하나로 통일되는 효과도 얻을 수 있기 때문이다.</p><p><code class="language-plaintext highlighter-rouge">Docker</code> 는 상황에 따라 서버를 빠르게 바꿔서 재배포를 해야하는 상황에 대비하기 위해 (이번 프로젝트에서는 그럴 일은 없겠지만..) 배포 버전의 프로젝트를 Docker 이미지로 빌드하여 Push 해두고 배포할 서버에서 해당 이미지를 가져와 실행만 시키면 되도록 하기 위함이다.</p><h2 id="문제상황">문제상황</h2><p>리액트로 개발한 프론트엔트 프로젝트는 웹팩으로 번들링 한 정적 파일을 NGINX로 호스팅하는 방식으로 배포된다(도커 이미지로 만들어 배포하고 있다). 그리고 백엔드의 API를 호출할때 필요한 <strong>API_BASE_URL</strong> 환경변수를 서버 환경에 맞게 주입 받도록 구현이 되어 있었다.</p><p>처음 배포를 했을 때는 프론트엔드에서 백엔드 API를 호출하는 코드가 없었고 개발 과정에서는 localhost:3000 같은 고정된 URL로 API를 호출했기 때문에 환경 변수를 주입해 줄 필요가 없어서 이 부분을 생각하지 못했었는데, 백엔드 API를 호출하는 코드가 추가되면서 NGINX로 호스팅 중인 정적 파일에 런타임 시점에서 환경 변수를 주입해 줄 수 없는 문제를 만나게 되었다.</p><h2 id="해결과정1---번들링-시점에-환경변수-주입-">해결과정1 - 번들링 시점에 환경변수 주입 (❌)</h2><p>이 문제를 해결하기 위해 처음에는 Webpack을 사용하는 프로젝트 환경에서 환경 변수를 어떻게 주입해주는지 찾아봤는데, <code class="language-plaintext highlighter-rouge">dotenv-webpack</code> 패키지를 이용하거나 직접 webpack의 DefinePlugin을 이용하여 주입해주는 방법이 있다.</p><p>이 방법을 이용하여 GitHub Repository Secret에 API_BASE_URL 환경변수 값을 등록해두고 GitHub Action에서 빌드를 진행할때 해당 secret 값을 환경변수로 주입해주었다.</p><p>일단 이 방법을 통해 현재 배포할 서버의 URL로 API_BASE_URL을 설정해 줄 수 있었다. 그러나 얼마 못 가 깨닳은 점은 이 방식은 빌드 시점에 환경 변수가 고정이 되기 때문에 배포 할 서버가 변경되면 해당 이미지는 사용할 수 없게 되고, secret 값을 변경하여 다시 빌드를 해주어야 한다는 점이었다.</p><p>배포 과정에서 서버를 유연하게 변경할 수 있도록 Docker를 사용했는데 그 의미를 잃어버린 것이다.</p><p>dotenv-webpack 패키지를 이용하거나 DefinePlugin을 이용하여 주입해주는 방식은 환경변수를 이용하는 부분의 코드가 주입된 String값으로 대치된 번들 파일이 만들어진다. 그렇기 때문에 번들링 이후에는 환경 변수를 변경할 수 있는 방법은 없을 것 같다는 생각이 들었다.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">//번들링 전</span>
<span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">//번들링 후</span>
<span class="k">if</span><span class="p">(</span><span class="dl">'</span><span class="s1">production</span><span class="dl">'</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="해결과정2---nginx-proxy-설정-이용-">해결과정2 - NGINX proxy 설정 이용 (✅)</h2><p>결국 다시 원점에서 문제 해결을 위한 방법을 찾던 중 아래 글에서 하나의 실마리를 찾을 수 있었다.</p><p><a href="https://qastack.kr/server/577370/how-can-i-use-environment-variables-in-nginx-conf">https://qastack.kr/server/577370/how-can-i-use-environment-variables-in-nginx-conf</a></p><p>NGINX는 특정 요청을 다른 곳으로 redirect 시키거나 proxy 시키는 설정이 가능하다. 이 점을 이용하면 프론트엔드에서 특정 path로 요청을 발생시키고 해당 요청을 백엔드 서버가 배포된 서버로 proxy 시켜주는 구조로 구현을 해볼 수 있을 것 같았다.</p><p>이 방법을 테스트 해보기 위해 production으로 빌드를 할 때 API_BASE_URL이 <code class="language-plaintext highlighter-rouge">/api</code> 로 주입되도록 설정해주었다.</p><p><strong>webpack.config.js</strong></p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
      <span class="dl">'</span><span class="s1">process.env.API_BASE_URL</span><span class="dl">'</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span>
          <span class="p">?</span> <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span>
          <span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">)</span>
    <span class="p">})</span>
  <span class="p">]</span>
<span class="p">};</span>
</pre></table></code></div></div><p><strong>axios.js</strong></p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">baseURL</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_BASE_URL</span><span class="p">,</span>
<span class="p">});</span>

<span class="p">...</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">instance</span><span class="p">;</span>
</pre></table></code></div></div><p>다음으로는 NGINX에서 <code class="language-plaintext highlighter-rouge">/api</code> 로 오는 요청에 대한 proxy 설정을 추가해주었다.</p><p><strong>app.conf</strong></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>server {
  listen 80;

  location / {
    root   /usr/share/nginx/html;
    index  index.html index.htm;
    try_files $uri /index.html;
  }

  location /api/ {
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://backend_server_url/;
  }
}
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">http://backend_server_url/</code> 부분엔 백엔드 서버가 배포된 서버의 주소를 입력해주면 된다. 한가지 주의할 점은 끝에 <code class="language-plaintext highlighter-rouge">/</code> 를 붙여주어야 proxy 되는 URL에도 <code class="language-plaintext highlighter-rouge">/api/</code> 이후 path를 이어서 붙여준다고 한다.</p><p>설정을 마치고 서버에 배포된 상황을 만들기 위해 도커를 이용하여 실행시켜 주고 테스트 해본 결과 프론트 컨테이너에서 <code class="language-plaintext highlighter-rouge">/api/...</code> 로 요청이 발생할 경우 백엔드 컨테이너로 요청이 잘 전달되고 있었다.</p><p>로컬에서 도커를 이용하여 충분히 테스트를 마친 후 배포 서버에서도 적용시켜 본 결과 마찬가지로 잘 동작하는 것을 확인할 수 있었다.</p><p>conf 파일은 배포 서버에서 도커 이미지를 실행하는 시점에 volume 옵션을 통해 넣어줄 수 있기 때문에 서버를 유연하게 변경하기 위한 목적에도 부합하는 방법이고 이후에 다른 API 서버가 추가될 경우 proxy 설정만 추가해주면 되기 때문에 확장성도 확보할 수 있다. 🤩 (야호)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/programming/'>Programming</a>, <a href='/categories/devops/'>DevOps</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/react/" class="post-tag no-text-decoration" >React</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >DevOps</a> <a href="/tags/%EB%AC%B8%EC%A0%9C%ED%95%B4%EA%B2%B0/" class="post-tag no-text-decoration" >문제해결</a> <a href="/tags/nginx/" class="post-tag no-text-decoration" >NGINX</a> <a href="/tags/webpack/" class="post-tag no-text-decoration" >Webpack</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=React 프로젝트 배포 삽질기 - Changhee&url=https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=React 프로젝트 배포 삽질기 - Changhee&u=https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=React 프로젝트 배포 삽질기 - Changhee&url=https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/2%EC%9D%BC%EA%B0%84_%EC%94%A8%EB%A6%84%ED%96%88%EB%8D%98_Connection_reset_by_peer/">2일간 씨름했던 Connection reset by peer</a><li><a href="/posts/%EB%A6%AC%EC%96%BC%EC%84%9C%EB%B9%84%EC%8A%A4_%EC%B2%AB%EA%B2%BD%ED%97%98_%EB%B0%98%EC%84%B1%EC%9D%BC%EA%B8%B0/">리얼서비스 첫경험 반성일기</a><li><a href="/posts/Atomic%EA%B3%BC_Synchronized/">Atomic과 Synchronized</a><li><a href="/posts/Git-add-commit-%EB%82%B4%EB%B6%80%EB%8F%99%EC%9E%91-%ED%99%95%EC%9D%B8%ED%95%B4%EB%B3%B4%EA%B8%B0/">Git add와 commit 내부동작 확인해보기</a><li><a href="/posts/ArrayList-vs-LinkedList/">ArrayList vs LinkedList</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/mac/">Mac</a> <a class="post-tag" href="/tags/db/">DB</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/promise/">Promise</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/ubuntu/">Ubuntu</a> <a class="post-tag" href="/tags/%EA%B0%9C%EB%B0%9C%EC%9E%90/">개발자</a> <a class="post-tag" href="/tags/%EC%9D%B4%EB%B2%A4%ED%8A%B8%EB%A3%A8%ED%94%84/">이벤트루프</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/NCP%EC%97%90%EC%84%9C_HA_%EA%B5%AC%EC%84%B1%ED%95%B4%EB%B3%B4%EA%B8%B0/"><div class="card-body"> <span class="timeago small" > Dec 30, 2020 <i class="unloaded">2020-12-30T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NCP에서 HA 구성해보기</h3><div class="text-muted small"><p> 부스트캠프에서 팀프로젝트를 하면서 HAProxy를 이용한 로드밸런싱을 구현했었는데 실제 서비스에서는 안정성을 위해 Proxy 서버를 이중화하여 HA(High Availability)를 구성한다고 한다. HA 구성에 대한 자료를 찾아보니 마침 NCP(네이버 클라우드 플랫폼) 환경에서 HA를 구성하는 방법이 있었는데 직접 적용해보면서 그 과정을 정리하려...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%84%9C%EB%B2%84%EB%B3%B4%EC%95%88/"><div class="card-body"> <span class="timeago small" > Dec 12, 2020 <i class="unloaded">2020-12-12T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>서버 보안 설정 정리</h3><div class="text-muted small"><p> SSH root 접속 / password 로그인 방지 1 sudo nano /etc/ssh/sshd_config sshd_config 1 2 PermitRootLogin no //root 접속 허용 x PasswordAuthentication no //password 접속 허용 x sshd 재실행 1 sudo service sshd res...</p></div></div></a></div><div class="card"> <a href="/posts/Bean_%EC%A0%95%EB%A6%AC/"><div class="card-body"> <span class="timeago small" > Jan 11, 2021 <i class="unloaded">2021-01-11T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bean 정리</h3><div class="text-muted small"><p> Bean 빈(Bean)이란 Spring의 IoC 컨테이너에서 의존성을 주입하기 위해 내부적으로 생성하는 객체를 말한다. 이렇게 컨테이너에서 의존성을 관리해주기 때문에 제어가 역전(IoC - Inversion of Control) 되었다고 하며 개발자가 직접 의존성 객체를 생성하고 주입해주지 않아도 되기 때문에 개발 과정이 간편해지는 장점이 있다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/TypeORM%EA%B3%BC-Webpack-%EC%97%B0%EB%8F%99%EC%98%A4%EB%A5%98%ED%95%B4%EA%B2%B0/" class="btn btn-outline-primary"><p>TypeORM과 Webpack 연동 `Critical dependency: the request of a dependency is an expression` 오류 해결</p></a> <a href="/posts/%EC%84%9C%EB%B2%84%EB%B3%B4%EC%95%88/" class="btn btn-outline-primary"><p>서버 보안 설정 정리</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//changheedev.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://changheedev.github.io/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/'; this.page.identifier = '/posts/React_%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_%EB%B0%B0%ED%8F%AC_%EC%82%BD%EC%A7%88%EA%B8%B0/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/changheedev">Changhee Choi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/mac/">Mac</a> <a class="post-tag" href="/tags/db/">DB</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/promise/">Promise</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/ubuntu/">Ubuntu</a> <a class="post-tag" href="/tags/%EA%B0%9C%EB%B0%9C%EC%9E%90/">개발자</a> <a class="post-tag" href="/tags/%EC%9D%B4%EB%B2%A4%ED%8A%B8%EB%A3%A8%ED%94%84/">이벤트루프</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://changheedev.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
